# é¡¹ç›®æ¶æ„æ–‡æ¡£

## ğŸ“ ç›®å½•ç»“æ„

```
minecraft-wiki-api/
â”œâ”€â”€ src/                           # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ config/                    # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.js              # ç¯å¢ƒå˜é‡é…ç½®å’ŒéªŒè¯
â”‚   â”œâ”€â”€ controllers/               # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ searchController.js   # æœç´¢APIæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ pageController.js     # é¡µé¢APIæ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ healthController.js   # å¥åº·æ£€æŸ¥æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ middleware/                # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ errorHandler.js       # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ validation.js         # è¯·æ±‚éªŒè¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/                    # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.js              # ä¸»è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ search.js             # æœç´¢è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ pages.js              # é¡µé¢è·¯ç”±
â”‚   â”‚   â””â”€â”€ health.js             # å¥åº·æ£€æŸ¥è·¯ç”±
â”‚   â”œâ”€â”€ services/                  # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ wikiSearchService.js  # Wikiæœç´¢æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ wikiPageService.js    # Wikié¡µé¢æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ searchUrlBuilder.js   # æœç´¢URLæ„å»ºå™¨
â”‚   â”‚   â”œâ”€â”€ searchResultsParser.js # æœç´¢ç»“æœè§£æå™¨
â”‚   â”‚   â”œâ”€â”€ pageUrlHandler.js     # é¡µé¢URLå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ pageContentParser.js  # é¡µé¢å†…å®¹è§£æå™¨
â”‚   â”‚   â””â”€â”€ htmlToMarkdownConverter.js # HTMLè½¬Markdownè½¬æ¢å™¨
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ httpClient.js         # HTTPå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ logger.js             # æ—¥å¿—å·¥å…·
â”‚   â”‚   â”œâ”€â”€ errors.js             # é”™è¯¯å®šä¹‰
â”‚   â”‚   â””â”€â”€ portManager.js        # ç«¯å£ç®¡ç†å·¥å…·
â”‚   â””â”€â”€ index.js                  # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ tests/                         # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ setup.js                  # Jestæµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ app.test.js               # åº”ç”¨åŸºç¡€æµ‹è¯•
â”‚   â””â”€â”€ realNetwork.test.js       # ç½‘ç»œé›†æˆæµ‹è¯•
â”œâ”€â”€ docs/                          # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ API_DOCUMENTATION.md      # APIæ¥å£æ–‡æ¡£
â”‚   â”œâ”€â”€ environment-variables-guide.md # ç¯å¢ƒå˜é‡é…ç½®æŒ‡å—
â”‚   â””â”€â”€ PROJECT_STRUCTURE.md      # é¡¹ç›®æ¶æ„æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ default.js                # é»˜è®¤é…ç½®æ–‡ä»¶
â”œâ”€â”€ logs/                          # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ .env.example                   # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ jest.config.js                 # Jestæµ‹è¯•é…ç½®
â”œâ”€â”€ package.json                   # é¡¹ç›®é…ç½®å’Œä¾èµ–
â””â”€â”€ README.md                      # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Routes                 â”‚  â† HTTPè·¯ç”±å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            Controllers             â”‚  â† æ§åˆ¶å™¨å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             Services               â”‚  â† ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Utils                 â”‚  â† å·¥å…·ç±»å±‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

#### 1. è·¯ç”±å±‚ (Routes)
- **èŒè´£**: HTTPè¯·æ±‚è·¯ç”±å’ŒåŸºç¡€éªŒè¯
- **æ–‡ä»¶**: `src/routes/`
- **ç‰¹ç‚¹**: RESTful APIè®¾è®¡ï¼Œæ”¯æŒç‰ˆæœ¬æ§åˆ¶

#### 2. æ§åˆ¶å™¨å±‚ (Controllers)
- **èŒè´£**: è¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€å“åº”æ ¼å¼åŒ–
- **æ–‡ä»¶**: `src/controllers/`
- **ç‰¹ç‚¹**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼

#### 3. æœåŠ¡å±‚ (Services)
- **èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€æ•°æ®å¤„ç†
- **æ–‡ä»¶**: `src/services/`
- **ç‰¹ç‚¹**: æ¨¡å—åŒ–è®¾è®¡ï¼Œå¯å¤ç”¨ç»„ä»¶

**ä¸»è¦æœåŠ¡ç»„ä»¶:**
- **WikiPageService**: é¡µé¢å†…å®¹è·å–æœåŠ¡ï¼Œæ”¯æŒHTMLã€Markdownã€Wikitextæ ¼å¼
- **WikiSearchService**: æœç´¢æœåŠ¡ï¼Œæ”¯æŒå…³é”®è¯æœç´¢å’Œç»“æœè§£æ
- **SearchUrlBuilder**: æœç´¢URLæ„å»ºå™¨ï¼Œå¤„ç†ä¸­æ–‡ç¼–ç å’Œå‘½åç©ºé—´
- **PageUrlHandler**: é¡µé¢URLå¤„ç†å™¨ï¼Œæ”¯æŒå¸¸è§„é¡µé¢å’Œç¼–è¾‘é¡µé¢URLæ„å»º
- **SearchResultsParser**: æœç´¢ç»“æœè§£æå™¨ï¼Œä½¿ç”¨Cheerioè§£æHTML
- **PageContentParser**: é¡µé¢å†…å®¹è§£æå™¨ï¼Œæå–ç»“æ„åŒ–å†…å®¹
- **HtmlToMarkdownConverter**: HTMLåˆ°Markdownè½¬æ¢å™¨

**æ–°å¢WikitextåŠŸèƒ½:**
- **getPageSource()**: é€šè¿‡ `?action=edit` å‚æ•°è·å–é¡µé¢æºä»£ç 
- **æ”¯æŒæ‰¹é‡Wikitextè·å–**: æ‰¹é‡å¤„ç†å¤šä¸ªé¡µé¢çš„æºä»£ç 
- **ç¼“å­˜æœºåˆ¶**: ä¸ç°æœ‰ç¼“å­˜ç³»ç»Ÿé›†æˆï¼Œæå‡æ€§èƒ½

#### 4. å·¥å…·å±‚ (Utils)
- **èŒè´£**: é€šç”¨å·¥å…·å‡½æ•°ã€è¾…åŠ©åŠŸèƒ½
- **æ–‡ä»¶**: `src/utils/`
- **ç‰¹ç‚¹**: æ— çŠ¶æ€å‡½æ•°ï¼Œé«˜åº¦å¯å¤ç”¨

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- **Express.js**: é«˜æ€§èƒ½ Node.js Web æ¡†æ¶
- **Node.js 18+**: ç°ä»£ JavaScript è¿è¡Œæ—¶

### æ•°æ®å¤„ç†
- **Cheerio**: æœåŠ¡ç«¯ jQueryï¼Œç”¨äº HTML è§£æå’ŒWikitextæºä»£ç æå–
- **Turndown**: HTML åˆ° Markdown çš„è½¬æ¢å™¨
- **Axios**: Promise åŸºç¡€çš„ HTTP å®¢æˆ·ç«¯
- **Wikitextæ”¯æŒ**: é€šè¿‡ `?action=edit` å‚æ•°è·å–é¡µé¢æºä»£ç 

### å®‰å…¨å’Œä¸­é—´ä»¶
- **Helmet**: å®‰å…¨ HTTP å¤´éƒ¨è®¾ç½®
- **CORS**: è·¨åŸŸèµ„æºå…±äº«æ§åˆ¶
- **express-rate-limit**: è¯·æ±‚é¢‘ç‡é™åˆ¶

### æ—¥å¿—å’Œç›‘æ§
- **Winston**: ä¼ä¸šçº§æ—¥å¿—è®°å½•åº“
- **ç»“æ„åŒ–æ—¥å¿—**: JSON æ ¼å¼æ—¥å¿—è¾“å‡º

### å¼€å‘å’Œæµ‹è¯•
- **Jest**: JavaScript æµ‹è¯•æ¡†æ¶
- **Supertest**: HTTP æ–­è¨€åº“
- **Nodemon**: å¼€å‘æ—¶è‡ªåŠ¨é‡å¯

## ğŸ”„ æ•°æ®æµ

### æœç´¢æµç¨‹
```
HTTP Request â†’ Routes â†’ Controller â†’ SearchService â†’ UrlBuilder â†’ HttpClient â†’ Wiki API
                                                   â†“
HTTP Response â† Controller â† SearchService â† ResultsParser â† Wiki Response
```

### é¡µé¢è·å–æµç¨‹
```
HTTP Request â†’ Routes â†’ Controller â†’ PageService â†’ UrlHandler â†’ HttpClient â†’ Wiki Page
                                                 â†“
HTTP Response â† Controller â† PageService â† ContentParser â† MarkdownConverter â† HTML Content
```

### Wikitextæºä»£ç è·å–æµç¨‹
```
HTTP Request â†’ Routes â†’ Controller â†’ PageService â†’ UrlHandler (with action=edit) â†’ HttpClient â†’ Wiki Edit Page
                                                 â†“
HTTP Response â† Controller â† PageService â† SourceExtractor â† HTML Parsing â† Edit Page Content
```

## ğŸ“¦ æ¨¡å—ä¾èµ–å…³ç³»

```
Controllers
    â†“
Services
    â†“
Utils (HttpClient, Logger, etc.)
```

### ä¾èµ–åŸåˆ™
- **å•å‘ä¾èµ–**: ä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œä¸‹å±‚ä¸ä¾èµ–ä¸Šå±‚
- **æ¥å£éš”ç¦»**: é€šè¿‡æ¥å£å®šä¹‰æ¨¡å—è¾¹ç•Œ
- **ä¾èµ–æ³¨å…¥**: æ”¯æŒé…ç½®å’Œæµ‹è¯•çš„çµæ´»æ€§

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•åˆ†å±‚
- **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªå‡½æ•°å’Œç±»
- **é›†æˆæµ‹è¯•**: æµ‹è¯•æ¨¡å—é—´äº¤äº’
- **ç«¯åˆ°ç«¯æµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„APIæµç¨‹

### æµ‹è¯•æ–‡ä»¶ç»„ç»‡
```
tests/
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ services/           # æœåŠ¡å±‚æµ‹è¯•
â”‚   â”œâ”€â”€ utils/              # å·¥å…·ç±»æµ‹è¯•
â”‚   â””â”€â”€ controllers/        # æ§åˆ¶å™¨æµ‹è¯•
â”œâ”€â”€ integration/            # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ api/               # APIé›†æˆæµ‹è¯•
â””â”€â”€ e2e/                   # ç«¯åˆ°ç«¯æµ‹è¯•
    â””â”€â”€ scenarios/         # æµ‹è¯•åœºæ™¯
```

## ğŸ”§ é…ç½®ç®¡ç†

### é…ç½®å±‚çº§
1. **é»˜è®¤é…ç½®**: `config/default.js`
2. **ç¯å¢ƒå˜é‡**: `.env` æ–‡ä»¶
3. **è¿è¡Œæ—¶é…ç½®**: ç¯å¢ƒå˜é‡è¦†ç›–

### é…ç½®éªŒè¯
- å¯åŠ¨æ—¶è‡ªåŠ¨éªŒè¯æ‰€æœ‰é…ç½®
- ç±»å‹æ£€æŸ¥å’ŒèŒƒå›´éªŒè¯
- ç¼ºå¤±é…ç½®çš„å‹å¥½é”™è¯¯æç¤º

## ğŸ“ æ—¥å¿—æ¶æ„

### æ—¥å¿—çº§åˆ«
- **error**: é”™è¯¯ä¿¡æ¯
- **warn**: è­¦å‘Šä¿¡æ¯
- **info**: ä¸€èˆ¬ä¿¡æ¯
- **debug**: è°ƒè¯•ä¿¡æ¯

### æ—¥å¿—è¾“å‡º
- **æ§åˆ¶å°**: å¼€å‘ç¯å¢ƒå®æ—¶æŸ¥çœ‹
- **æ–‡ä»¶**: ç”Ÿäº§ç¯å¢ƒæŒä¹…åŒ–å­˜å‚¨
- **ç»“æ„åŒ–**: JSONæ ¼å¼ä¾¿äºåˆ†æ

## ğŸš€ éƒ¨ç½²æ¶æ„

### å•æœºéƒ¨ç½²
```
Load Balancer (Nginx)
    â†“
Node.js Application
    â†“
File System (Logs, Cache)
```

### åˆ†å¸ƒå¼éƒ¨ç½²
```
Load Balancer
    â†“
Multiple Node.js Instances
    â†“
Redis (Shared Cache)
    â†“
Centralized Logging
```

## ğŸ”„ æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•
- æ— çŠ¶æ€è®¾è®¡ï¼Œæ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
- å…±äº«ç¼“å­˜ï¼ˆRedisï¼‰æ”¯æŒ
- è´Ÿè½½å‡è¡¡å‹å¥½

### å‚ç›´æ‰©å±•
- å†…å­˜ç¼“å­˜ä¼˜åŒ–
- å¼‚æ­¥å¤„ç†æ”¯æŒ
- èµ„æºä½¿ç”¨ç›‘æ§

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
- **å¤šå±‚ç¼“å­˜**: å†…å­˜ + Redis
- **æ™ºèƒ½å¤±æ•ˆ**: TTL + LRU
- **ç¼“å­˜é¢„çƒ­**: çƒ­ç‚¹æ•°æ®é¢„åŠ è½½

### å¹¶å‘å¤„ç†
- **å¼‚æ­¥I/O**: éé˜»å¡æ“ä½œ
- **è¿æ¥æ± **: HTTPè¿æ¥å¤ç”¨
- **é™æµä¿æŠ¤**: é˜²æ­¢è¿‡è½½

## ğŸ”’ å®‰å…¨è®¾è®¡

### è¾“å…¥éªŒè¯
- å‚æ•°ç±»å‹æ£€æŸ¥
- é•¿åº¦å’Œæ ¼å¼é™åˆ¶
- SQLæ³¨å…¥é˜²æŠ¤

### è®¿é—®æ§åˆ¶
- IPé™æµ
- CORSé…ç½®
- å®‰å…¨å¤´éƒ¨è®¾ç½®

### é”™è¯¯å¤„ç†
- ç»Ÿä¸€é”™è¯¯æ ¼å¼
- æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
- è¯¦ç»†æ—¥å¿—è®°å½•